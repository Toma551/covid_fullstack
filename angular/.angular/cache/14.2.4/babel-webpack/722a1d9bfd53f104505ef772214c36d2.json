{"ast":null,"code":"import _asyncToGenerator from \"D:/Documents/Fullstack/Commun Thomas/covid_fullstack/angular/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";\nimport { interval } from 'rxjs';\nimport * as i0 from \"@angular/core\";\nimport * as i1 from \"@angular/common/http\";\nimport * as i2 from \"@angular/router\";\nexport class WaitingComponent {\n  constructor(http, router) {\n    this.http = http;\n    this.router = router;\n    this.infos = '';\n    this.tokens = '';\n    this.duree = '';\n    this.temps = 0;\n    this.tempsRestant = 0;\n    this.finishedTimer = false;\n  }\n\n  ngOnInit() {\n    this.info();\n  }\n\n  reset() {\n    this.infos = '', this.tokens = '';\n    this.duree = '';\n    this.temps = 0;\n    this.tempsRestant = 0;\n    this.finishedTimer = false;\n  }\n\n  info() {\n    this.reset();\n    this.http.get('api/infos', {\n      observe: 'response'\n    }).subscribe({\n      next: resp => {\n        console.log(resp);\n        console.log(resp.headers.keys());\n        const nbToken = resp.headers.get('X-Rate-Limit-Remaining');\n        this.tokens = `${nbToken}`;\n      },\n      error: err => {\n        console.error(err);\n        console.log(err.headers.keys());\n        this.temps = err.headers.get('X-Rate-Limit-Retry-After-Seconds');\n        this.duree = `${this.temps}`;\n\n        if (this.temps > 0) {\n          this.startTimer();\n        }\n      }\n    });\n  }\n\n  startTimer() {\n    var _this = this;\n\n    const tempsInitial = this.temps;\n    this.tempsRestant = this.temps;\n    const timer$ = interval(1000);\n    const sub = timer$.subscribe( /*#__PURE__*/function () {\n      var _ref = _asyncToGenerator(function* (sec) {\n        sec = sec + 1;\n        _this.tempsRestant = tempsInitial - sec;\n        _this.duree = `${_this.tempsRestant}`;\n\n        if (_this.tempsRestant <= 0) {\n          sub.unsubscribe();\n          yield new Promise(f => setTimeout(f, 1000));\n\n          _this.router.navigate(['centers']);\n\n          _this.info();\n        }\n      });\n\n      return function (_x) {\n        return _ref.apply(this, arguments);\n      };\n    }());\n  }\n\n}\n\nWaitingComponent.Éµfac = function WaitingComponent_Factory(t) {\n  return new (t || WaitingComponent)(i0.ÉµÉµdirectiveInject(i1.HttpClient), i0.ÉµÉµdirectiveInject(i2.Router));\n};\n\nWaitingComponent.Éµcmp = /*@__PURE__*/i0.ÉµÉµdefineComponent({\n  type: WaitingComponent,\n  selectors: [[\"app-waiting\"]],\n  decls: 9,\n  vars: 2,\n  consts: [[1, \"avertissement\"], [1, \"texte\"]],\n  template: function WaitingComponent_Template(rf, ctx) {\n    if (rf & 1) {\n      i0.ÉµÉµelementStart(0, \"div\", 0)(1, \"p\");\n      i0.ÉµÉµtext(2, \"OOPS ! \\uD83D\\uDE31\\uD83D\\uDE31\");\n      i0.ÉµÉµelementEnd()();\n      i0.ÉµÉµelementStart(3, \"div\", 1);\n      i0.ÉµÉµtext(4, \" Vous avez effectu\\u00E9 un nombre trop important de requ\\u00EAtes. \");\n      i0.ÉµÉµelement(5, \"br\");\n      i0.ÉµÉµtext(6);\n      i0.ÉµÉµelementEnd();\n      i0.ÉµÉµelement(7, \"br\");\n      i0.ÉµÉµtext(8);\n    }\n\n    if (rf & 2) {\n      i0.ÉµÉµadvance(6);\n      i0.ÉµÉµtextInterpolate1(\"Veuillez r\\u00E9essayer dans \", ctx.duree, \" secondes.\\n\");\n      i0.ÉµÉµadvance(2);\n      i0.ÉµÉµtextInterpolate1(\"\", ctx.tokens, \" tokens restants \");\n    }\n  },\n  styles: [\".avertissement[_ngcontent-%COMP%] {\\n  font-size: 40px;\\n  font-weight: bold;\\n  width: -moz-fit-content;\\n  width: fit-content;\\n  border: 1px solid rgba(0, 0, 0, 0.425);\\n}\\n\\n.texte[_ngcontent-%COMP%] {\\n  font-size: 20px;\\n  width: -moz-fit-content;\\n  width: fit-content;\\n  border: 1px solid rgba(0, 0, 0, 0.425);\\n}\\n/*# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndhaXRpbmcuY29tcG9uZW50LnNjc3MiLCIuLlxcLi5cXC4uXFwuLlxcLi5cXC4uXFxDb21tdW4lMjBUaG9tYXNcXGNvdmlkX2Z1bGxzdGFja1xcYW5ndWxhclxcc3JjXFxhcHBcXHdhaXRpbmdcXHdhaXRpbmcuY29tcG9uZW50LnNjc3MiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7RUFDSSxlQUFBO0VBQ0EsaUJBQUE7RUFDQSx1QkFBQTtFQUFBLGtCQUFBO0VBQ0Esc0NBQUE7QUNDSjs7QURFQTtFQUNJLGVBQUE7RUFDQSx1QkFBQTtFQUFBLGtCQUFBO0VBQ0Esc0NBQUE7QUNDSiIsImZpbGUiOiJ3YWl0aW5nLmNvbXBvbmVudC5zY3NzIiwic291cmNlc0NvbnRlbnQiOlsiLmF2ZXJ0aXNzZW1lbnQge1xyXG4gICAgZm9udC1zaXplOiA0MHB4O1xyXG4gICAgZm9udC13ZWlnaHQ6IGJvbGQ7XHJcbiAgICB3aWR0aDogZml0LWNvbnRlbnQ7XHJcbiAgICBib3JkZXI6IDFweCBzb2xpZCByZ2JhKDAsIDAsIDAsIDAuNDI1KTtcclxufVxyXG5cclxuLnRleHRlIHtcclxuICAgIGZvbnQtc2l6ZTogMjBweDtcclxuICAgIHdpZHRoOiBmaXQtY29udGVudDtcclxuICAgIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwgMCwgMCwgMC40MjUpO1xyXG59IiwiLmF2ZXJ0aXNzZW1lbnQge1xuICBmb250LXNpemU6IDQwcHg7XG4gIGZvbnQtd2VpZ2h0OiBib2xkO1xuICB3aWR0aDogZml0LWNvbnRlbnQ7XG4gIGJvcmRlcjogMXB4IHNvbGlkIHJnYmEoMCwgMCwgMCwgMC40MjUpO1xufVxuXG4udGV4dGUge1xuICBmb250LXNpemU6IDIwcHg7XG4gIHdpZHRoOiBmaXQtY29udGVudDtcbiAgYm9yZGVyOiAxcHggc29saWQgcmdiYSgwLCAwLCAwLCAwLjQyNSk7XG59Il19 */\"]\n});","map":{"version":3,"mappings":";AAEA,SAASA,QAAT,QAAyB,MAAzB;;;;AAQA,OAAM,MAAOC,gBAAP,CAAuB;EAE3BC,YACmBC,IADnB,EAEmBC,MAFnB,EAEiC;IADd;IACA;IAGnB,aAAQ,EAAR;IACA,cAAS,EAAT;IACA,aAAQ,EAAR;IAEA,aAAQ,CAAR;IACA,oBAAe,CAAf;IACA,qBAAgB,KAAhB;EARO;;EAUPC,QAAQ;IACN,KAAKC,IAAL;EACD;;EAEDC,KAAK;IACH,KAAKC,KAAL,GAAa,EAAb,EACA,KAAKC,MAAL,GAAc,EADd;IAEA,KAAKC,KAAL,GAAa,EAAb;IACA,KAAKC,KAAL,GAAa,CAAb;IACA,KAAKC,YAAL,GAAoB,CAApB;IACA,KAAKC,aAAL,GAAqB,KAArB;EACD;;EAEDP,IAAI;IACF,KAAKC,KAAL;IACA,KAAKJ,IAAL,CAAUW,GAAV,CAAmB,WAAnB,EAAgC;MAACC,OAAO,EAAE;IAAV,CAAhC,EACCC,SADD,CACW;MACTC,IAAI,EAAGC,IAAD,IAAS;QACfC,OAAO,CAACC,GAAR,CAAYF,IAAZ;QACAC,OAAO,CAACC,GAAR,CAAYF,IAAI,CAACG,OAAL,CAAaC,IAAb,EAAZ;QACA,MAAMC,OAAO,GAAIL,IAAI,CAACG,OAAL,CAAaP,GAAb,CAAiB,wBAAjB,CAAjB;QACA,KAAKL,MAAL,GAAc,GAAGc,OAAO,EAAxB;MACD,CANU;MAOXC,KAAK,EAAIC,GAAD,IAAQ;QACdN,OAAO,CAACK,KAAR,CAAcC,GAAd;QACAN,OAAO,CAACC,GAAR,CAAYK,GAAG,CAACJ,OAAJ,CAAYC,IAAZ,EAAZ;QACA,KAAKX,KAAL,GAAcc,GAAG,CAACJ,OAAJ,CAAYP,GAAZ,CAAgB,kCAAhB,CAAd;QACA,KAAKJ,KAAL,GAAa,GAAG,KAAKC,KAAK,EAA1B;;QACA,IAAI,KAAKA,KAAL,GAAa,CAAjB,EAAoB;UAClB,KAAKe,UAAL;QACD;MACF;IAfU,CADX;EAkBD;;EAEDA,UAAU;IAAA;;IACR,MAAMC,YAAY,GAAG,KAAKhB,KAA1B;IACA,KAAKC,YAAL,GAAoB,KAAKD,KAAzB;IACA,MAAMiB,MAAM,GAAG5B,QAAQ,CAAC,IAAD,CAAvB;IAEA,MAAM6B,GAAG,GAAGD,MAAM,CAACZ,SAAP;MAAA,6BAAiB,WAAOc,GAAP,EAAc;QACzCA,GAAG,GAAGA,GAAG,GAAC,CAAV;QACA,KAAI,CAAClB,YAAL,GAAoBe,YAAY,GAAGG,GAAnC;QACA,KAAI,CAACpB,KAAL,GAAa,GAAG,KAAI,CAACE,YAAY,EAAjC;;QACA,IAAI,KAAI,CAACA,YAAL,IAAqB,CAAzB,EAA4B;UAC1BiB,GAAG,CAACE,WAAJ;UACA,MAAM,IAAIC,OAAJ,CAAYC,CAAC,IAAIC,UAAU,CAACD,CAAD,EAAI,IAAJ,CAA3B,CAAN;;UACA,KAAI,CAAC7B,MAAL,CAAY+B,QAAZ,CAAqB,CAAC,SAAD,CAArB;;UACA,KAAI,CAAC7B,IAAL;QACD;MACF,CAVW;;MAAA;QAAA;MAAA;IAAA,IAAZ;EAWD;;AAlE0B;;;mBAAhBL,kBAAgBmC;AAAA;;;QAAhBnC;EAAgBoC;EAAAC;EAAAC;EAAAC;EAAAC;IAAA;MCV7BL,+BAA6B,CAA7B,EAA6B,GAA7B;MACKA;MAAWA;MAGhBA;MACEA;MACAA;MAAIA;MACNA;MAEAA;MAAIA;;;;MAHEA;MAAAA;MAGFA;MAAAA","names":["interval","WaitingComponent","constructor","http","router","ngOnInit","info","reset","infos","tokens","duree","temps","tempsRestant","finishedTimer","get","observe","subscribe","next","resp","console","log","headers","keys","nbToken","error","err","startTimer","tempsInitial","timer$","sub","sec","unsubscribe","Promise","f","setTimeout","navigate","i0","selectors","decls","vars","consts","template"],"sourceRoot":"","sources":["D:\\Documents\\Fullstack\\Commun Thomas\\covid_fullstack\\angular\\src\\app\\waiting\\waiting.component.ts","D:\\Documents\\Fullstack\\Commun Thomas\\covid_fullstack\\angular\\src\\app\\waiting\\waiting.component.html"],"sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { Component, OnInit } from '@angular/core';\r\nimport { interval } from 'rxjs';\r\nimport { Router } from '@angular/router';\r\n\r\n@Component({\r\n  selector: 'app-waiting',\r\n  templateUrl: './waiting.component.html',\r\n  styleUrls: ['./waiting.component.scss']\r\n})\r\nexport class WaitingComponent implements OnInit {\r\n\r\n  constructor(\r\n    private readonly http: HttpClient,\r\n    private readonly router: Router\r\n    ) { }\r\n\r\n  infos = '';\r\n  tokens = '';\r\n  duree = '';\r\n  private sub: any;\r\n  temps = 0;\r\n  tempsRestant = 0;\r\n  finishedTimer = false;\r\n\r\n  ngOnInit(): void {\r\n    this.info()\r\n  }\r\n\r\n  reset() {\r\n    this.infos = '',\r\n    this.tokens = '';\r\n    this.duree = '';\r\n    this.temps = 0;\r\n    this.tempsRestant = 0;\r\n    this.finishedTimer = false;\r\n  }\r\n\r\n  info() {\r\n    this.reset();\r\n    this.http.get<any>('api/infos', {observe: 'response'})\r\n    .subscribe({\r\n      next: (resp) => {\r\n      console.log(resp);\r\n      console.log(resp.headers.keys());\r\n      const nbToken =  resp.headers.get('X-Rate-Limit-Remaining')\r\n      this.tokens = `${nbToken}`\r\n    },\r\n    error:  (err) => {\r\n      console.error(err);\r\n      console.log(err.headers.keys());\r\n      this.temps =  err.headers.get('X-Rate-Limit-Retry-After-Seconds')\r\n      this.duree = `${this.temps}`;\r\n      if (this.temps > 0) {\r\n        this.startTimer();\r\n      }\r\n    }\r\n    });\r\n  }\r\n\r\n  startTimer() {\r\n    const tempsInitial = this.temps;\r\n    this.tempsRestant = this.temps;\r\n    const timer$ = interval(1000);\r\n\r\n    const sub = timer$.subscribe(async (sec) => {\r\n      sec = sec+1;\r\n      this.tempsRestant = tempsInitial - sec;\r\n      this.duree = `${this.tempsRestant}`;\r\n      if (this.tempsRestant <= 0) {\r\n        sub.unsubscribe();\r\n        await new Promise(f => setTimeout(f, 1000));\r\n        this.router.navigate(['centers']);\r\n        this.info();\r\n      }\r\n    });\r\n  }\r\n\r\n}\r\n","<div class = \"avertissement\">\r\n  <p>OOPS ! ðŸ˜±ðŸ˜±</p>\r\n</div>\r\n\r\n<div class = \"texte\">\r\n  Vous avez effectuÃ© un nombre trop important de requÃªtes.\r\n  <br>Veuillez rÃ©essayer dans {{duree}} secondes.\r\n</div>\r\n\r\n<br>{{tokens}} tokens restants\r\n\r\n<!-- *ngIf=\"duree\" -->"]},"metadata":{},"sourceType":"module"}